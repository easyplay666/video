<!DOCTYPE html>
<html lang="zh">
<head>
<meta charset="UTF-8">
<title>视频录制程序</title>
<style>
body {
    font-family: Arial, sans-serif;
    text-align: center;
}
video {
    width: 640px;
    background: black;
}
button {
    margin: 5px;
    padding: 10px 15px;
}
button:disabled {
    opacity: 0.4;
}
#timer {
    font-size: 18px;
    margin: 10px;
}
#download {
    display: none;
    margin-top: 10px;
}
</style>
</head>

<body>

<h2>视频录制程序</h2>

<video id="preview" autoplay muted></video>

<div id="timer">00:00</div>

<div>
    <button id="startBtn">开始录制</button>
    <button id="pauseBtn" disabled>暂停</button>
    <button id="resumeBtn" disabled>继续</button>
    <button id="stopBtn" disabled>停止</button>
</div>

<a id="download" href="#" download="recording.webm">
⬇ 下载录制的视频
</a>

<script>
let mediaRecorder;
let recordedChunks = [];
let stream;

let timerInterval;
let seconds = 0;

const preview = document.getElementById("preview");
const startBtn = document.getElementById("startBtn");
const pauseBtn = document.getElementById("pauseBtn");
const resumeBtn = document.getElementById("resumeBtn");
const stopBtn = document.getElementById("stopBtn");
const timerDisplay = document.getElementById("timer");
const downloadLink = document.getElementById("download");

/* ===== 计时 ===== */
function resetTimer() {
    clearInterval(timerInterval);
    seconds = 0;
    timerDisplay.textContent = "00:00";
}

function startTimer() {
    timerInterval = setInterval(() => {
        seconds++;
        const min = String(Math.floor(seconds / 60)).padStart(2, "0");
        const sec = String(seconds % 60).padStart(2, "0");
        timerDisplay.textContent = `${min}:${sec}`;
    }, 1000);
}

/* ===== 开始 ===== */
startBtn.onclick = async () => {
    downloadLink.style.display = "none";
    resetTimer();

    stream = await navigator.mediaDevices.getUserMedia({
        video: true,
        audio: true
    });

    preview.srcObject = stream;
    preview.play();

    recordedChunks = [];
    mediaRecorder = new MediaRecorder(stream);

    mediaRecorder.ondataavailable = e => {
        if (e.data.size > 0) recordedChunks.push(e.data);
    };

    mediaRecorder.onstop = () => {
        const blob = new Blob(recordedChunks, { type: "video/webm" });
        const url = URL.createObjectURL(blob);

        downloadLink.href = url;
        downloadLink.style.display = "inline-block";

        stream.getTracks().forEach(track => track.stop());

        startBtn.disabled = false;
    };

    mediaRecorder.start();
    startTimer();

    startBtn.disabled = true;
    pauseBtn.disabled = false;
    resumeBtn.disabled = true;
    stopBtn.disabled = false;
};

/* ===== 暂停 ===== */
pauseBtn.onclick = () => {
    mediaRecorder.pause();
    preview.pause();     // 画面冻结
    clearInterval(timerInterval);

    pauseBtn.disabled = true;
    resumeBtn.disabled = false;
};

/* ===== 继续 ===== */
resumeBtn.onclick = () => {
    mediaRecorder.resume();
    preview.play();      // 画面恢复
    startTimer();

    resumeBtn.disabled = true;
    pauseBtn.disabled = false;
};

/* ===== 停止 ===== */
stopBtn.onclick = () => {
    mediaRecorder.stop();
    clearInterval(timerInterval);

    pauseBtn.disabled = true;
    resumeBtn.disabled = true;
    stopBtn.disabled = true;
};
</script>

</body>
</html>
