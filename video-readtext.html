<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <title>信纸版双语教学录制工具</title>
    <script src="https://unpkg.com/pinyin-pro"></script>
    <style>
        :root { --yt-red: #cc0000; --paper-bg: #fdf5e6; --line-color: #d1e9ff; --accent: #b03a2e; }
        body { 
            font-family: "PingFang SC", "Kaiti", "STKaiti", serif; 
            background: #1a1a1a; color: white; margin: 0; 
            display: flex; flex-direction: column; align-items: center;
        }
        
        /* UI控制区 */
        #ui-controls { 
            background: #333; padding: 20px; width: 100%; 
            display: flex; flex-direction: column; align-items: center; gap: 15px; 
            z-index: 2000;
        }
        .controls-row { display: flex; gap: 15px; align-items: center; }
        textarea { 
            width: 85%; max-width: 800px; height: 100px; 
            padding: 12px; border-radius: 4px; font-size: 14px;
        }
        #startBtn { padding: 12px 30px; cursor: pointer; background: var(--yt-red); color: white; border: none; border-radius: 4px; font-weight: bold; }

        /* 视频舞台 */
        #stage-viewport { margin: 20px auto; display: flex; justify-content: center; align-items: center; background: #000; }
        
        #recording-stage {
            background-color: var(--paper-bg);
            /* 创建信纸横线效果 */
            background-image: linear-gradient(var(--line-color) 1px, transparent 1px);
            background-size: 100% 32px; /* 线条间距 */
            color: #2c3e50; 
            padding: 60px 40px 40px 60px; /* 左边留出空间放指示器 */
            box-sizing: border-box; position: relative; overflow: hidden;
            line-height: 32px; /* 必须与背景线间距一致 */
        }

        .mode-youtube { width: 854px; height: 480px; }
        .mode-mobile { width: 360px; height: 640px; }

        /* 录制状态 */
        body.is-recording #ui-controls { display: none; }
        body.is-recording #stage-viewport { margin: 0; width: 100vw; height: 100vh; }

        /* 文本行样式 */
        .text-line-wrapper {
            display: flex; align-items: center; position: relative;
            height: 32px; margin-bottom: 0;
        }
        
        .text-line {
            font-size: 20px; /* 缩小字号以容纳更多文字 */
            color: #444; transition: all 0.3s;
            white-space: nowrap; overflow: hidden; text-overflow: ellipsis;
            padding-left: 10px;
        }
        
        /* 阅读时的指示器（箭头） */
        .indicator {
            position: absolute; left: -35px;
            color: var(--yt-red); font-size: 20px;
            opacity: 0; transition: opacity 0.2s;
        }

        /* 激活状态 */
        .text-line-wrapper.active .text-line {
            color: var(--yt-red);
            font-weight: bold;
            transform: translateX(5px);
        }
        .text-line-wrapper.active .indicator {
            opacity: 1;
            animation: bounce 0.5s infinite alternate;
        }

        @keyframes bounce {
            from { transform: translateX(0); }
            to { transform: translateX(-5px); }
        }

        /* Logo区 */
        #logo-area { position: absolute; top: 15px; left: 20px; display: flex; align-items: center; gap: 8px; line-height: 1; }
        .logo-icon { width: 24px; height: 24px; background: var(--accent); color: white; border-radius: 4px; display: flex; align-items: center; justify-content: center; font-size: 14px; }
        .logo-text { font-size: 12px; font-weight: bold; color: #888; }

        #download-link { position: fixed; top: 20px; right: 20px; background: #27ae60; padding: 12px 20px; color: white; border-radius: 8px; text-decoration: none; display: none; z-index: 3000; }
    </style>
</head>
<body>

<div id="ui-controls">
    <div class="controls-row">
        <button onclick="setMode('youtube')" id="btn-yt" style="padding:8px">16:9 (YouTube)</button>
        <button onclick="setMode('mobile')" id="btn-mb" style="padding:8px">9:16 (手机)</button>
        <button id="startBtn">开始录制教案</button>
    </div>
    <textarea id="multiInput">Bonjour, comment ça va ?
你好，你怎么样？
J'apprends le français tous les jours.
我每天学习法语。
C'est un beau papier pour écrire.
这是一个漂亮的书写纸。
Bonne chance avec votre projet !
祝你的项目好运！</textarea>
</div>

<div id="stage-viewport">
    <div id="recording-stage" class="mode-youtube">
        <div id="logo-area">
            <div class="logo-icon">法</div>
            <div class="logo-text">每日法语课堂</div>
        </div>
        <div id="content-list">
            </div>
    </div>
</div>

<a id="download-link" href="#">⬇ 下载录制视频</a>

<script>
    const startBtn = document.getElementById('startBtn');
    const contentList = document.getElementById('content-list');
    const stage = document.getElementById('recording-stage');
    
    function setMode(mode) {
        stage.className = mode === 'youtube' ? 'mode-youtube' : 'mode-mobile';
    }

    function speak(text) {
        return new Promise((resolve) => {
            const utterance = new SpeechSynthesisUtterance(text);
            const isChinese = /[\u4e00-\u9fa5]/.test(text);
            utterance.lang = isChinese ? 'zh-CN' : 'fr-FR';
            utterance.rate = 0.85;
            utterance.onend = resolve;
            window.speechSynthesis.speak(utterance);
        });
    }

    async function startProcess() {
        const lines = document.getElementById('multiInput').value.split('\n').filter(l => l.trim());
        if(!lines.length) return;

        try {
            const stream = await navigator.mediaDevices.getDisplayMedia({
                video: { displaySurface: "browser" },
                audio: true
            });

            document.body.classList.add('is-recording');
            
            const recorder = new MediaRecorder(stream, { mimeType: 'video/webm;codecs=vp9' });
            const chunks = [];
            recorder.ondataavailable = e => chunks.push(e.data);
            recorder.onstop = () => {
                const blob = new Blob(chunks, { type: 'video/webm' });
                document.getElementById('download-link').href = URL.createObjectURL(blob);
                document.getElementById('download-link').style.display = 'block';
                document.body.classList.remove('is-recording');
            };

            // 生成列表
            contentList.innerHTML = '';
            const elements = lines.map(text => {
                const wrapper = document.createElement('div');
                wrapper.className = 'text-line-wrapper';
                wrapper.innerHTML = `<span class="indicator">▶</span><div class="text-line">${text}</div>`;
                contentList.appendChild(wrapper);
                return wrapper;
            });

            recorder.start();
            await new Promise(r => setTimeout(r, 1000));

            // 逐行阅读
            for (let i = 0; i < elements.length; i++) {
                elements[i].classList.add('active');
                await speak(lines[i]);
                await new Promise(r => setTimeout(r, 400));
                elements[i].classList.remove('active');
            }

            await new Promise(r => setTimeout(r, 1000));
            recorder.stop();
            stream.getTracks().forEach(t => t.stop());

        } catch (e) {
            document.body.classList.remove('is-recording');
        }
    }

    startBtn.addEventListener('click', startProcess);
</script>

</body>
</html>
