<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ‰‹æœºåŒºåŸŸè´è¶å½•åˆ¶</title>
    <style>
        body {
            margin: 0;
            padding: 0;
            background: #222;
            color: white;
            font-family: sans-serif;
            display: flex;
            flex-direction: column;
            align-items: center;
            min-height: 100vh;
        }

        /* --- æ§åˆ¶åŒº --- */
        #controls {
            margin: 20px;
            z-index: 100;
            display: flex;
            gap: 15px;
        }

        button {
            padding: 10px 20px;
            font-size: 16px;
            cursor: pointer;
            background: #444;
            color: #fff;
            border: 1px solid #666;
            border-radius: 5px;
            transition: 0.2s;
        }
        button:hover { background: #666; }
        button#recordBtn { background: #cc0000; border: none; font-weight: bold; }
        button#recordBtn:hover { background: #ff0000; }

        #download-link {
            display: none;
            color: #4CAF50;
            font-weight: bold;
            margin-top: 10px;
        }

        /* --- æ‰‹æœºå±å¹•å®¹å™¨ --- */
        /* è¿™æ˜¯ä¸€ä¸ªæ¨¡æ‹Ÿæ‰‹æœºçš„å®¹å™¨ï¼Œè´è¶åªèƒ½åœ¨è¿™é‡Œé£ */
        #phone-screen {
            width: 360px;   /* æ‰‹æœºå®½åº¦ */
            height: 640px;  /* æ‰‹æœºé«˜åº¦ */
            background: radial-gradient(circle at bottom, #1a1a2e 0%, #16213e 100%); /* æ·±é‚ƒå¤œç©ºèƒŒæ™¯ */
            border: 10px solid #111;
            border-radius: 30px; /* åœ†è§’æœºèº« */
            box-shadow: 0 0 20px rgba(0,0,0,0.5), inset 0 0 10px rgba(0,0,0,0.8);
            position: relative;
            overflow: hidden; /* å…³é”®ï¼šè´è¶é£å‡ºè¾¹ç•Œä¼šè¢«è—èµ·æ¥ */
            cursor: crosshair; /* æç¤ºè¿™é‡Œå¯ä»¥äº¤äº’ */
            transition: all 0.3s ease;
        }
        
        /* æ‰‹æœºé¡¶éƒ¨çš„åˆ˜æµ·/å¬ç­’è£…é¥° */
        #phone-screen::before {
            content: '';
            position: absolute;
            top: 0; left: 50%;
            transform: translateX(-50%);
            width: 120px; height: 25px;
            background: #111;
            border-bottom-left-radius: 15px;
            border-bottom-right-radius: 15px;
            z-index: 100;
        }

        /* --- è´è¶æ ·å¼ (ä¿æŒä¹‹å‰çš„æ¼‚äº®è®¾è®¡) --- */
        #butterfly {
            position: absolute;
            width: 80px;
            height: 80px;
            left: 50%; top: 50%;
            transform: translate(-50%, -50%);
            pointer-events: none; /* è®©é¼ æ ‡äº‹ä»¶ç©¿é€è´è¶ï¼Œç‚¹åˆ°èƒŒæ™¯ */
            z-index: 50;
            filter: drop-shadow(0 0 8px rgba(0, 255, 255, 0.6));
        }

        .wing {
            position: absolute;
            width: 40px; height: 60px;
            top: 5px;
            background: linear-gradient(45deg, rgba(255, 0, 204, 0.9), rgba(0, 200, 255, 0.9));
            border-radius: 50% 50% 50% 50% / 60% 60% 40% 40%;
            transform-origin: bottom center;
            mix-blend-mode: screen;
        }
        .wing::after {
            content: ''; position: absolute;
            top: 5px; left: 5px; right: 5px; bottom: 10px;
            border: 1px solid rgba(255,255,255,0.4);
            border-radius: 50%;
        }

        .left-wing { left: 0; transform: rotate(-30deg); animation: flap-left 0.15s infinite alternate ease-in-out; }
        .right-wing { right: 0; transform: rotate(30deg) scaleX(-1); animation: flap-right 0.15s infinite alternate ease-in-out; }

        .wing-bottom { width: 25px; height: 35px; top: 40px; z-index: -1; filter: brightness(0.8); }
        .left-bottom { left: 8px; transform-origin: top right; animation: flap-left-b 0.15s infinite alternate; }
        .right-bottom { right: 8px; transform-origin: top left; animation: flap-right-b 0.15s infinite alternate; }

        .body {
            position: absolute; width: 4px; height: 35px; background: #fff;
            left: 50%; top: 20px; transform: translateX(-50%);
            border-radius: 10px; box-shadow: 0 0 5px #fff;
        }
        .antenna {
            position: absolute; width: 1px; height: 15px; background: #fff; top: -10px; left: 50%;
            opacity: 0.8; transform-origin: bottom;
        }
        .antenna.left { transform: translateX(-50%) rotate(-25deg); }
        .antenna.right { transform: translateX(-50%) rotate(25deg); }

        @keyframes flap-left { 0% { transform: rotateY(0deg) rotate(-10deg); } 100% { transform: rotateY(60deg) rotate(-10deg); } }
        @keyframes flap-right { 0% { transform: rotateY(0deg) rotate(10deg) scaleX(-1); } 100% { transform: rotateY(60deg) rotate(10deg) scaleX(-1); } }
        @keyframes flap-left-b { 0% { transform: rotateY(0deg) rotate(-20deg); } 100% { transform: rotateY(60deg) rotate(-20deg); } }
        @keyframes flap-right-b { 0% { transform: rotateY(0deg) rotate(20deg) scaleX(-1); } 100% { transform: rotateY(60deg) rotate(20deg) scaleX(-1); } }


        /* --- å½•åˆ¶æ¨¡å¼æ ·å¼ (å…³é”®ï¼) --- */
        /* å½“ body åŠ ä¸Š is-recording ç±»æ—¶ï¼Œéšè—æ‰€æœ‰å¤šä½™å…ƒç´ ï¼Œåªå±…ä¸­æ˜¾ç¤ºæ‰‹æœº */
        body.is-recording {
            background: #000; /* å½•åˆ¶æ—¶èƒŒæ™¯å…¨é»‘ */
            justify-content: center;
            height: 100vh;
            overflow: hidden;
        }
        body.is-recording #controls, 
        body.is-recording #download-link {
            display: none !important; /* éšè—æŒ‰é’® */
        }
        body.is-recording #phone-screen {
            border: none; /* å½•åˆ¶æ—¶å¦‚æœä¸æƒ³çœ‹åˆ°æ‰‹æœºè¾¹æ¡†ï¼Œå¯ä»¥æŠŠè¿™ä¸ªå»æ‰ï¼Œæˆ–è€…ä¿ç•™ */
            border-radius: 0; /* å˜æˆç›´è§’ï¼Œå……æ»¡ç”»é¢ï¼Ÿæˆ–è€…ä¿æŒæ‰‹æœºæ · */
            /* å¦‚æœæƒ³è¦å½•åˆ¶ç»“æœå°±æ˜¯æ‰‹æœºç”»é¢ï¼Œå»ºè®®ä¿æŒåŸæ ·å±…ä¸­ï¼Œ
               æˆ–è€…ä½ æƒ³è®©ç”»é¢å……æ»¡ï¼Œå¯ä»¥è§£å¼€ä¸‹é¢è¿™è¡Œæ³¨é‡Šï¼š */
            /* transform: scale(1.5); */ 
            box-shadow: none;
        }

    </style>
</head>
<body>

    <div id="controls">
        <button id="recordBtn">ğŸ”´ å¼€å§‹å½•åˆ¶è§†é¢‘</button>
    </div>
    <a id="download-link" href="#">â¬‡ ä¸‹è½½è§†é¢‘</a>

    <div id="phone-screen">
        <div id="butterfly">
            <div class="wing left-wing"></div>
            <div class="wing wing-bottom left-bottom"></div>
            <div class="wing right-wing"></div>
            <div class="wing wing-bottom right-bottom"></div>
            <div class="body">
                <div class="antenna left"></div>
                <div class="antenna right"></div>
            </div>
        </div>
    </div>

    <script>
        const phoneScreen = document.getElementById('phone-screen');
        const butterfly = document.getElementById('butterfly');
        const recordBtn = document.getElementById('recordBtn');
        const downloadLink = document.getElementById('download-link');

        // --- è´è¶é€»è¾‘ ---
        
        // è´è¶åœ¨æ‰‹æœºå†…çš„ä½ç½®
        let currentX = 180;
        let currentY = 320;
        // ç›®æ ‡ä½ç½®
        let targetX = 180;
        let targetY = 320;
        
        let angle = 0;

        // ç›‘å¬æ•´ä¸ªæ–‡æ¡£çš„é¼ æ ‡ç§»åŠ¨ï¼Œä½†æˆ‘ä»¬ä¼šæŠŠåæ ‡è½¬æ¢é™åˆ¶åœ¨æ‰‹æœºæ¡†å†…
        document.addEventListener('mousemove', (e) => {
            // è·å–æ‰‹æœºå±å¹•ç›¸å¯¹äºæµè§ˆå™¨çª—å£çš„ä½ç½®å’Œå¤§å°
            const rect = phoneScreen.getBoundingClientRect();

            // è®¡ç®—é¼ æ ‡ç›¸å¯¹äºæ‰‹æœºå·¦ä¸Šè§’çš„åæ ‡
            let relativeX = e.clientX - rect.left;
            let relativeY = e.clientY - rect.top;

            // é™åˆ¶ï¼ˆClampï¼‰åæ ‡ï¼šä¸è®©è´è¶é£å‡ºæ‰‹æœº
            // æ¯”å¦‚ï¼šä¸èƒ½å°äº0ï¼Œä¸èƒ½å¤§äº360
            relativeX = Math.max(0, Math.min(relativeX, rect.width));
            relativeY = Math.max(0, Math.min(relativeY, rect.height));

            targetX = relativeX;
            targetY = relativeY;
        });

        function animateButterfly() {
            // ç¼“åŠ¨è·Ÿéšç®—æ³•
            const dx = targetX - currentX;
            const dy = targetY - currentY;

            // é€Ÿåº¦ç³»æ•° 0.05ï¼Œæ•°å€¼è¶Šå°è·Ÿéšè¶Šæ…¢è¶Šå¹³æ»‘
            currentX += dx * 0.05;
            currentY += dy * 0.05;

            // è§’åº¦è®¡ç®— (è®©å¤´æœå‘é£è¡Œæ–¹å‘)
            if (Math.abs(dx) > 0.5 || Math.abs(dy) > 0.5) {
                // +90åº¦æ˜¯å› ä¸ºè´è¶ç´ æé»˜è®¤å¤´æœä¸Š
                const targetAngle = Math.atan2(dy, dx) * (180 / Math.PI) + 90;
                // è§’åº¦å¹³æ»‘è¿‡æ¸¡
                let angleDiff = targetAngle - angle;
                // å¤„ç† 360/0 åº¦çªå˜é—®é¢˜
                while (angleDiff > 180) angleDiff -= 360;
                while (angleDiff < -180) angleDiff += 360;
                
                angle += angleDiff * 0.1;
            }

            // åº”ç”¨ä½ç½® (æ³¨æ„ï¼šè¿™æ˜¯ç›¸å¯¹äº #phone-screen çš„ç»å¯¹å®šä½)
            butterfly.style.left = `${currentX}px`;
            butterfly.style.top = `${currentY}px`;
            butterfly.style.transform = `translate(-50%, -50%) rotate(${angle}deg)`;

            requestAnimationFrame(animateButterfly);
        }
        
        // å¯åŠ¨è´è¶
        animateButterfly();


        // --- å½•åˆ¶é€»è¾‘ (å¤ç”¨ä¹‹å‰çš„æŠ€æœ¯) ---

        let mediaRecorder;
        let recordedChunks = [];
        let isRecording = false;

        recordBtn.addEventListener('click', async () => {
            if (!isRecording) {
                // 1. å¼€å§‹å½•åˆ¶
                try {
                    // è¯·æ±‚å½•åˆ¶å½“å‰æ ‡ç­¾é¡µ
                    const stream = await navigator.mediaDevices.getDisplayMedia({
                        video: { displaySurface: "browser" },
                        audio: false
                    });

                    // è¿›å…¥â€œå½•åˆ¶æ¨¡å¼â€ï¼šæ·»åŠ  classï¼Œéšè—æŒ‰é’®ï¼ŒèƒŒæ™¯å˜é»‘ï¼Œæ‰‹æœºå±…ä¸­
                    document.body.classList.add('is-recording');
                    downloadLink.style.display = 'none';

                    mediaRecorder = new MediaRecorder(stream, { mimeType: 'video/webm; codecs=vp9' });
                    
                    mediaRecorder.ondataavailable = (e) => {
                        if (e.data.size > 0) recordedChunks.push(e.data);
                    };

                    mediaRecorder.onstop = () => {
                        // åœæ­¢åçš„å¤„ç†
                        const blob = new Blob(recordedChunks, { type: 'video/webm' });
                        const url = URL.createObjectURL(blob);
                        downloadLink.href = url;
                        downloadLink.download = 'butterfly_phone.webm';
                        downloadLink.style.display = 'block';
                        downloadLink.innerText = "âœ… å½•åˆ¶å®Œæˆï¼Œç‚¹å‡»ä¸‹è½½è§†é¢‘";
                        
                        // é€€å‡ºå½•åˆ¶æ¨¡å¼ï¼Œæ¢å¤ç•Œé¢
                        document.body.classList.remove('is-recording');
                        isRecording = false;
                        recordBtn.innerText = "ğŸ”´ å¼€å§‹å½•åˆ¶è§†é¢‘";
                        recordBtn.style.background = "#cc0000";
                        
                        // åœæ­¢æ‰€æœ‰è½¨é“ï¼ˆå…³é—­æµè§ˆå™¨é¡¶éƒ¨çš„å½•åˆ¶çº¢ç‚¹ï¼‰
                        stream.getTracks().forEach(track => track.stop());
                    };

                    mediaRecorder.start();
                    isRecording = true;
                    recordBtn.innerText = "â¹ åœæ­¢å½•åˆ¶ (æˆ–ç‚¹å‡»æµè§ˆå™¨åœæ­¢å…±äº«)";
                    recordBtn.style.background = "#333";
                    
                    // ç›‘å¬æµè§ˆå™¨è‡ªå¸¦çš„â€œåœæ­¢å…±äº«â€æ¡
                    stream.getVideoTracks()[0].onended = () => {
                        if (isRecording) mediaRecorder.stop();
                    };

                } catch (err) {
                    console.error("Error: " + err);
                    // å¦‚æœç”¨æˆ·å–æ¶ˆé€‰æ‹©ï¼Œä¹Ÿè¦æ¢å¤ç•Œé¢
                    document.body.classList.remove('is-recording');
                }
            } else {
                // 2. æ‰‹åŠ¨åœæ­¢å½•åˆ¶
                mediaRecorder.stop();
            }
        });

    </script>
</body>
</html>
