<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ‰‹æœºåŒºåŸŸè´è¶å½•åˆ¶ (ä¿®å¤ç‰ˆ)</title>
    <style>
        body {
            margin: 0;
            padding: 0;
            background: #222;
            color: white;
            font-family: sans-serif;
            display: flex;
            flex-direction: column;
            align-items: center;
            min-height: 100vh;
        }

        /* --- åˆå§‹æ§åˆ¶åŒº --- */
        #controls {
            margin: 20px;
            z-index: 100;
            display: flex;
            gap: 15px;
            align-items: center;
        }

        button {
            padding: 10px 20px;
            font-size: 16px;
            cursor: pointer;
            border-radius: 5px;
            border: none;
            transition: 0.2s;
        }

        #startBtn { background: #4CAF50; color: white; font-weight: bold; }
        #startBtn:hover { background: #45a049; }

        /* --- å½•åˆ¶ä¸­æ˜¾ç¤ºçš„åœæ­¢æŒ‰é’® (é»˜è®¤éšè—) --- */
        #stopBtn {
            display: none; /* åˆå§‹éšè— */
            position: fixed;
            top: 20px;
            right: 20px;
            background: #cc0000;
            color: white;
            font-weight: bold;
            z-index: 9999;
            box-shadow: 0 0 10px rgba(0,0,0,0.5);
        }
        #stopBtn:hover { background: #ff0000; }

        #download-link {
            display: none;
            background: #2196F3;
            color: white;
            padding: 10px 20px;
            text-decoration: none;
            border-radius: 5px;
            font-weight: bold;
            margin-top: 10px;
            z-index: 200;
        }
        #download-link:hover { background: #0b7dda; }

        /* --- æ‰‹æœºå±å¹•å®¹å™¨ --- */
        #phone-screen {
            width: 360px;
            height: 640px;
            background: radial-gradient(circle at bottom, #1a1a2e 0%, #16213e 100%);
            border: 10px solid #111;
            border-radius: 30px;
            box-shadow: 0 0 20px rgba(0,0,0,0.5), inset 0 0 10px rgba(0,0,0,0.8);
            position: relative;
            overflow: hidden;
            cursor: crosshair;
            /* å±…ä¸­å¤„ç† */
            margin-top: 10px;
        }
        
        /* æ‰‹æœºåˆ˜æµ· */
        #phone-screen::before {
            content: ''; position: absolute; top: 0; left: 50%; transform: translateX(-50%);
            width: 120px; height: 25px; background: #111;
            border-bottom-left-radius: 15px; border-bottom-right-radius: 15px; z-index: 100;
        }

        /* --- è´è¶æ ·å¼ --- */
        #butterfly {
            position: absolute; width: 80px; height: 80px;
            left: 50%; top: 50%; transform: translate(-50%, -50%);
            pointer-events: none; z-index: 50;
            filter: drop-shadow(0 0 8px rgba(0, 255, 255, 0.6));
        }

        .wing {
            position: absolute; width: 40px; height: 60px; top: 5px;
            background: linear-gradient(45deg, rgba(255, 0, 204, 0.9), rgba(0, 200, 255, 0.9));
            border-radius: 50% 50% 50% 50% / 60% 60% 40% 40%;
            transform-origin: bottom center; mix-blend-mode: screen;
        }
        .wing::after {
            content: ''; position: absolute; top: 5px; left: 5px; right: 5px; bottom: 10px;
            border: 1px solid rgba(255,255,255,0.4); border-radius: 50%;
        }

        .left-wing { left: 0; transform: rotate(-30deg); animation: flap-left 0.15s infinite alternate ease-in-out; }
        .right-wing { right: 0; transform: rotate(30deg) scaleX(-1); animation: flap-right 0.15s infinite alternate ease-in-out; }

        .wing-bottom { width: 25px; height: 35px; top: 40px; z-index: -1; filter: brightness(0.8); }
        .left-bottom { left: 8px; transform-origin: top right; animation: flap-left-b 0.15s infinite alternate; }
        .right-bottom { right: 8px; transform-origin: top left; animation: flap-right-b 0.15s infinite alternate; }

        .body {
            position: absolute; width: 4px; height: 35px; background: #fff;
            left: 50%; top: 20px; transform: translateX(-50%);
            border-radius: 10px; box-shadow: 0 0 5px #fff;
        }
        .antenna {
            position: absolute; width: 1px; height: 15px; background: #fff; top: -10px; left: 50%; opacity: 0.8; transform-origin: bottom;
        }
        .antenna.left { transform: translateX(-50%) rotate(-25deg); }
        .antenna.right { transform: translateX(-50%) rotate(25deg); }

        @keyframes flap-left { 0% { transform: rotateY(0deg) rotate(-10deg); } 100% { transform: rotateY(60deg) rotate(-10deg); } }
        @keyframes flap-right { 0% { transform: rotateY(0deg) rotate(10deg) scaleX(-1); } 100% { transform: rotateY(60deg) rotate(10deg) scaleX(-1); } }
        @keyframes flap-left-b { 0% { transform: rotateY(0deg) rotate(-20deg); } 100% { transform: rotateY(60deg) rotate(-20deg); } }
        @keyframes flap-right-b { 0% { transform: rotateY(0deg) rotate(20deg) scaleX(-1); } 100% { transform: rotateY(60deg) rotate(20deg) scaleX(-1); } }


        /* --- å½•åˆ¶æ¨¡å¼çŠ¶æ€ --- */
        body.is-recording {
            background: #000; /* èƒŒæ™¯å…¨é»‘ */
            justify-content: center;
            overflow: hidden;
        }
        
        /* å½•åˆ¶æ—¶éšè—å¼€å§‹æŒ‰é’®å’Œä¸‹è½½é“¾æ¥ */
        body.is-recording #controls, 
        body.is-recording #download-link {
            display: none !important;
        }

        /* å½•åˆ¶æ—¶æ˜¾ç¤ºåœæ­¢æŒ‰é’® */
        body.is-recording #stopBtn {
            display: block !important;
        }

    </style>
</head>
<body>

    <div id="controls">
        <button id="startBtn">ğŸ”´ å¼€å§‹å½•åˆ¶è§†é¢‘</button>
        <span style="font-size: 14px; color: #aaa;">(å½•åˆ¶ä¸­æŒ‰ ESC é”®ä¹Ÿå¯åœæ­¢)</span>
    </div>

    <button id="stopBtn">â¹ åœæ­¢å½•åˆ¶</button>

    <a id="download-link" href="#">â¬‡ ç‚¹å‡»ä¸‹è½½è§†é¢‘</a>

    <div id="phone-screen">
        <div id="butterfly">
            <div class="wing left-wing"></div>
            <div class="wing wing-bottom left-bottom"></div>
            <div class="wing right-wing"></div>
            <div class="wing wing-bottom right-bottom"></div>
            <div class="body">
                <div class="antenna left"></div>
                <div class="antenna right"></div>
            </div>
        </div>
    </div>

    <script>
        const phoneScreen = document.getElementById('phone-screen');
        const butterfly = document.getElementById('butterfly');
        const startBtn = document.getElementById('startBtn');
        const stopBtn = document.getElementById('stopBtn');
        const downloadLink = document.getElementById('download-link');

        // --- è´è¶è·Ÿéšé€»è¾‘ ---
        let currentX = 180, currentY = 320;
        let targetX = 180, targetY = 320;
        let angle = 0;

        document.addEventListener('mousemove', (e) => {
            const rect = phoneScreen.getBoundingClientRect();
            // è®¡ç®—ç›¸å¯¹åæ ‡å¹¶é™åˆ¶åœ¨æ‰‹æœºèŒƒå›´å†…
            let relativeX = e.clientX - rect.left;
            let relativeY = e.clientY - rect.top;
            targetX = Math.max(0, Math.min(relativeX, rect.width));
            targetY = Math.max(0, Math.min(relativeY, rect.height));
        });

        function animate() {
            // å¹³æ»‘è·Ÿéš
            const dx = targetX - currentX;
            const dy = targetY - currentY;
            currentX += dx * 0.05;
            currentY += dy * 0.05;

            // è½¬å‘è®¡ç®—
            if (Math.abs(dx) > 0.5 || Math.abs(dy) > 0.5) {
                const targetAngle = Math.atan2(dy, dx) * (180 / Math.PI) + 90;
                let angleDiff = targetAngle - angle;
                while (angleDiff > 180) angleDiff -= 360;
                while (angleDiff < -180) angleDiff += 360;
                angle += angleDiff * 0.1;
            }

            butterfly.style.left = `${currentX}px`;
            butterfly.style.top = `${currentY}px`;
            butterfly.style.transform = `translate(-50%, -50%) rotate(${angle}deg)`;
            requestAnimationFrame(animate);
        }
        animate();


        // --- å½•åˆ¶é€»è¾‘ ---
        let mediaRecorder;
        let recordedChunks = [];
        let stream = null;

        // 1. å¼€å§‹å½•åˆ¶
        startBtn.addEventListener('click', async () => {
            try {
                stream = await navigator.mediaDevices.getDisplayMedia({
                    video: { displaySurface: "browser" },
                    audio: false
                });

                // ç•Œé¢è¿›å…¥å½•åˆ¶æ¨¡å¼
                document.body.classList.add('is-recording');
                downloadLink.style.display = 'none';
                recordedChunks = [];

                mediaRecorder = new MediaRecorder(stream, { mimeType: 'video/webm; codecs=vp9' });

                mediaRecorder.ondataavailable = (e) => {
                    if (e.data.size > 0) recordedChunks.push(e.data);
                };

                mediaRecorder.onstop = () => {
                    saveRecording();
                    resetUI();
                };

                mediaRecorder.start();

                // ç›‘å¬æµè§ˆå™¨è‡ªå¸¦çš„åœæ­¢æ¡
                stream.getVideoTracks()[0].onended = () => {
                    if (mediaRecorder.state !== 'inactive') mediaRecorder.stop();
                };

            } catch (err) {
                console.error("å–æ¶ˆå½•åˆ¶æˆ–å‡ºé”™:", err);
                resetUI();
            }
        });

        // 2. åœæ­¢å½•åˆ¶ (ç‚¹å‡»æŒ‰é’®)
        stopBtn.addEventListener('click', () => {
            if (mediaRecorder && mediaRecorder.state !== 'inactive') {
                mediaRecorder.stop();
            }
        });

        // 3. åœæ­¢å½•åˆ¶ (æŒ‰ ESC é”®)
        document.addEventListener('keydown', (e) => {
            if (e.key === "Escape" && document.body.classList.contains('is-recording')) {
                if (mediaRecorder && mediaRecorder.state !== 'inactive') {
                    mediaRecorder.stop();
                }
            }
        });

        // ä¿å­˜æ–‡ä»¶
        function saveRecording() {
            const blob = new Blob(recordedChunks, { type: 'video/webm' });
            const url = URL.createObjectURL(blob);
            downloadLink.href = url;
            downloadLink.download = `butterfly_recording_${new Date().getTime()}.webm`;
            downloadLink.style.display = 'block';
            downloadLink.innerText = "âœ… è§†é¢‘å·²ç”Ÿæˆï¼Œç‚¹å‡»ä¸‹è½½";
        }

        // æ¢å¤ç•Œé¢
        function resetUI() {
            document.body.classList.remove('is-recording');
            if (stream) {
                stream.getTracks().forEach(track => track.stop());
            }
        }
    </script>
</body>
</html>
